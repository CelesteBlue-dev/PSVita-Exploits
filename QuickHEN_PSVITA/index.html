<html>
<head>
<script src="gadgets.js"></script>
<script src="rop.js"></script>
<script src="oldpsvita_exploit.js"></script>
<script type="text/javascript">
const UNK = 0;
const PSP = 1;
const PSVITA = 2;
const PS3 = 3;
const PS4 = 4;
window.device = UNK;

function postLoad() {
	if (navigator.userAgent.substring(0, 29).localeCompare("Mozilla/5.0 (PlayStation Vita") == 0)
		window.device = PSVITA;

	if (window.device == PSVITA) {
		//alert(navigator.userAgent);
		var fwFromUA = navigator.userAgent.substring(navigator.userAgent.indexOf("5.0 (PlayStation Vita ")+22, navigator.userAgent.indexOf(") Apple"));
		var fw_major_string = fwFromUA.substring(fwFromUA.indexOf(""), fwFromUA.indexOf("."));
		var fw_minor_string = fwFromUA.substring(fwFromUA.indexOf(".")+3, fwFromUA.indexOf(fw_major_string)+2);
		window.psvita_fw = parseInt(fw_major_string) * 100 + parseInt(fw_minor_string);
		//alert(window.psvita_fw);
		
		if (window.psvita_fw < 200) {
			window.old_fw = true;
			//get_module_bases(); // not working
			oldpsvita_initROP();
		} else if (window.psvita_fw >= 200 && window.psvita_fw <= 320) {
			// vitasploit
		} else if (window.psvita_fw >= 330 && window.psvita_fw <= 336) {
			// vitasploit 33x
		} else if (window.psvita_fw >= 350 && window.psvita_fw <= 360) {
			// henkaku webkit
		} else
			alert("unsupported PSVita FW");
	}
}
</script>
</head>
<body id="BodyID" onload="postLoad();">
<div id="exploit"></div>
</body>
</html>